---
up: "[[入門Terraform クラウド時代のインフラ統合管理]]"
related:
tags:
  - terraform
aliases:
  - terraform
created: 2026-01-12
updated: 2026-01-12
---
### 概要

チームでTerraformを活用したい場合は、「HashiCorp」が提供するクラウドサービスHCP Terraformを使うと便利に利用できます

#### HCP Terraformとは何か
HashiCorpが提供するマネージドサービスです。
HCPは HashiCorp Cloud platformの略で、Terraformを始めとしたHashiCorpのプロダクトに関するクラウドサービスをまとめて提供します。

### 詳細

#### ==Terraform単体だと困ること==
Gitや踏み台サーバーを用意してコードを共有可能だが、ステートファイルの共有が大変
重複エラーや、予期せぬ上書きが発生してしまう可能性がある

下記は完全な解決策とは言えない
- gitリポジトリ
- オブジェクトストレージでステート共有
- 踏み台サーバーでコードとステートと共有

#### ==Terraformの運用のベストプラクティス==
HashiCorpからベストプラクティスが提唱されている
- 手動で行っていたプロビジョニングやデプロイのプロセスを自動化する
- インフラの構成に一貫性を持たせる
- Terraformコードをバージョンコントロールシステムで管理して修正履歴を残す
- TerraformのエキスパートがTerraformコードをテンプレート化（Terraformモジュールを作成）し、Terraformの初心者はそれらを利用する
- Terraformのワークスペース単位でアクセス制御を実施することにより、プロダクション環境を保護する
- アプリケーションの機能を開発する側は直接Terraformコードを書かない。ただしインフラの状態や変更内容は常に見られるようにしておく

#### ==HCP Terraformが提供する機能==
- ステートファイルの共有と管理
- Terraformコードのリモート実行
- Gitとの連携
- パスワードやクレデンシャルなどの管理


#### ==URL==

```cardlink
url: https://app.terraform.io/app/team_nishiyama/workspaces/new
title: "HCP Terraform"
host: app.terraform.io
```

#### ==HCP Terraform向けの設定を追加==

```hcl
cloud {
	organization = "<Organization名>"

	workspaces {
		name = "aws-infra"
	}
}
```

#### ==ログイン==
`terraform login` を実行
トークンを発行して、ターミナルに貼り付ける

#### ==ステートファイルを移行==
`terraform init` をやり直すだけで、ステートファイルが移動する
ローカルのステートファイルは空になって移動する

#### ==HCP Terraformの実行モード==
二つある
- クラウドで実行（デフォルト）
	- `Remote Execution`
	- AWS権限追加する必要がある
- 手元で実行
	- `Local Execution`
	- `settngs` から `Local` <mark style="background: #D2B3FFA6;">に変更する必要がある</mark>

#### ==リモート実行で確認する==
次はクラウド側も動けるようにする
上記設定すると、terraformコマンドの実行を契機として、実際の処理は `HCP Terraform` で行われるようになります
環境を ローカルやOSの差を無くし、`HCP Terraform` 側で統一できる

##### Execution Modeの変更
先ほどの設定で `Local` から `remote` に戻してワークスペースの `variables` でAWSの情報を追記する
設定する時は、`Environment variable` を選択して追加する
「Sensitive」を設定すると、値がマスクされるのでセキュリティレベルを上げれる

#### ==VSCと連携する==
GithubとHCP Terraformを連携することで、コードを共有しつつ、自動でplan実行等をcloud上でしてくれる（ステート管理も）
